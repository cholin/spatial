<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <title>Spatial</title>
    <link rel="stylesheet" href="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.css" />
    <script src="http://cdn.leafletjs.com/leaflet-0.7.3/leaflet.js"></script>
    <script src="http://cdnjs.cloudflare.com/ajax/libs/jquery/2.1.1/jquery.min.js"></script>

    <style>
      body {
          padding: 0;
          margin: 0;
      }
      html, body, #map {
          height: 100%;
          width: 100%;
      }
    </style>
    <!--<link rel="stylesheet" href="style.css">-->
    <!--<script src="script.js"></script>-->
  </head>
  <body>
    <div id="map"></div>
  </body>

  <script>
    var map = L.map('map').setView([51.8, 10], 6);
    L.tileLayer('https://{s}.tiles.mapbox.com/v3/{id}/{z}/{x}/{y}.png', {
            maxZoom: 18,
            id: 'examples.map-20v6611k'
    }).addTo(map);

    function onEachFeature(feature, layer) {
        if (feature.properties && feature.properties.name) {
            layer.bindPopup(feature.properties.name + " "+feature.properties.value);
        }
    }

    function setStyle(feature) {
      var hue = 30 + 240 * (50 - 2*feature.properties.value) / 60;
      return {
        "color": "hsl(" + [hue, '100%', '50%'] + ")",
        "weight": 0,
        "opacity": 0.65
      };
    }

    var geojson = L.geoJson([],{
          onEachFeature: onEachFeature,
          style: setStyle
        }).addTo(map);

    $.ajax({
      dataType: "json",
      url: "api/2014-07-01",
      success: function(data) {
        geojson.addData(data.measurements);
      }
    }).error(function() {});
  </script>
</html>

